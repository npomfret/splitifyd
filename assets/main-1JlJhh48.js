(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const g={SYNC_INTERVAL:5e3,CACHE_DURATION:5*60*1e3,REQUEST_TIMEOUT:8e3,MAX_PROJECTS:10,TOAST_DURATION:3e3,STORAGE_KEYS:{PROJECTS:"splitifyd_projects",ACTIVE_PROJECT:"splitifyd_active",PROJECT_ID:"splitifyd_project_id",USER_ID:"splitifyd_user_id"}},S={API_KEY:"$2a$10$hm7J97lLcGQCE9NGfef8ReIVgLddJrgsro7DJE14.vYdD.b01my1e",BASE_URL:"https://api.jsonbin.io/v3"};class K{async createProject(e){try{const t=await fetch(`${S.BASE_URL}/b`,{method:"POST",headers:{"Content-Type":"application/json","X-Master-Key":S.API_KEY,"X-Bin-Name":e.id,"X-Bin-Private":"false"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to create project: ${t.status}`);const r=await t.json();return{storageId:r.metadata.id,url:`https://api.jsonbin.io/v3/b/${r.metadata.id}`}}catch(t){throw console.error("Error creating project:",t),t}}async getProject(e){try{const t=await fetch(`${S.BASE_URL}/b/${e}/latest`,{method:"GET",headers:{"X-Master-Key":S.API_KEY}});if(!t.ok)throw new Error("Project not found");return(await t.json()).record}catch(t){throw console.error("Error fetching project:",t),t}}async updateProject(e,t){try{if(!(await fetch(`${S.BASE_URL}/b/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":S.API_KEY},body:JSON.stringify(t)})).ok)throw new Error("Failed to update project");return!0}catch(r){throw console.error("Error updating project:",r),r}}}const d={getProjects(){const n=localStorage.getItem(g.STORAGE_KEYS.PROJECTS);return n?JSON.parse(n):[]},addProject(n,e){const r=this.getProjects().filter(s=>s.storageId!==n);r.unshift({storageId:n,userId:e});const o=r.slice(0,g.MAX_PROJECTS);localStorage.setItem(g.STORAGE_KEYS.PROJECTS,JSON.stringify(o))},removeProject(n){const t=this.getProjects().filter(r=>r.storageId!==n);localStorage.setItem(g.STORAGE_KEYS.PROJECTS,JSON.stringify(t))},setActiveProject(n){localStorage.setItem(g.STORAGE_KEYS.ACTIVE_PROJECT,n)},getActiveProject(){return localStorage.getItem(g.STORAGE_KEYS.ACTIVE_PROJECT)},clearActiveProject(){localStorage.removeItem(g.STORAGE_KEYS.ACTIVE_PROJECT)},getUserIdForProject(n){const t=this.getProjects().find(r=>r.storageId===n);return t?t.userId:null},getProjectInfo(){return{projectId:localStorage.getItem(g.STORAGE_KEYS.PROJECT_ID),userId:localStorage.getItem(g.STORAGE_KEYS.USER_ID)}},getStorageId(n){return localStorage.getItem(`splitifyd_storage_${n}`)},clearLegacyData(){localStorage.removeItem(g.STORAGE_KEYS.PROJECT_ID),localStorage.removeItem(g.STORAGE_KEYS.USER_ID);for(let n=localStorage.length-1;n>=0;n--){const e=localStorage.key(n);e&&e.startsWith("splitifyd_storage_")&&localStorage.removeItem(e)}}};function L(n){const e="abcdefghijklmnopqrstuvwxyz0123456789";let t=n+"-";for(let r=0;r<6;r++)t+=e[Math.floor(Math.random()*e.length)];return t}function G(n){const e=new Date(n),r=(new Date-e)/(1e3*60*60);return r<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):r<48?"Yesterday":e.toLocaleDateString()}class V{createProject(e,t){const r=L("splitifyd"),o=L("user");return{id:r,name:e,members:[{id:o,name:t}],expenses:[],version:1,lastUpdated:Date.now(),userId:o}}addMember(e,t){const r={id:L("user"),name:t};return e.members.push(r),e.version++,e.lastUpdated=Date.now(),r}mergeProjects(e,t){return t.version>e.version?{...t}:t.version===e.version&&t.lastUpdated>e.lastUpdated?{...t}:e}validateProject(e){if(!e||typeof e!="object")throw new Error("Invalid project data");if(!e.id||!e.name)throw new Error("Project must have ID and name");if(!Array.isArray(e.members)||e.members.length===0)throw new Error("Project must have at least one member");if(!Array.isArray(e.expenses))throw new Error("Project must have expenses array");return!0}}class q{calculateBalances(e){if(!e)return{};const t={};return e.members.forEach(r=>{t[r.id]={}}),e.expenses.forEach(r=>{const o=r.currency;e.members.forEach(a=>{t[a.id][o]||(t[a.id][o]=0)}),t[r.paidBy]&&(t[r.paidBy][o]+=r.amount);const s=r.amount/r.splitBetween.length;r.splitBetween.forEach(a=>{t[a]&&(t[a][o]-=s)})}),t}calculateSettlements(e){const t=this.calculateBalances(e),r={},o=new Set;return Object.values(t).forEach(s=>{Object.keys(s).forEach(a=>o.add(a))}),o.forEach(s=>{const a=[],i=[];Object.entries(t).forEach(([f,h])=>{const v=h[s]||0;v<-.01?a.push({userId:f,amount:Math.abs(v)}):v>.01&&i.push({userId:f,amount:v})}),a.sort((f,h)=>h.amount-f.amount),i.sort((f,h)=>h.amount-f.amount),r[s]=[];let m=0,w=0;for(;m<a.length&&w<i.length;){const f=a[m],h=i[w],v=Math.min(f.amount,h.amount);v>.01&&r[s].push({from:f.userId,to:h.userId,amount:v,currency:s}),f.amount-=v,h.amount-=v,f.amount<.01&&m++,h.amount<.01&&w++}}),r}createExpense(e,t,r,o,s,a){return{id:L("exp"),description:e,amount:parseFloat(t),currency:r,paidBy:o,splitBetween:s,timestamp:Date.now(),addedBy:a}}createSettlement(e,t,r,o,s){return{id:L("exp"),description:"Settlement payment",amount:parseFloat(r),currency:o,paidBy:e,splitBetween:[t],timestamp:Date.now(),addedBy:s,isSettlement:!0}}validateExpense(e,t){if(!e.description||e.description.trim()==="")throw new Error("Description is required");if(!e.amount||e.amount<=0)throw new Error("Amount must be greater than 0");if(!e.paidBy||!t.members.find(o=>o.id===e.paidBy))throw new Error("Valid payer must be selected");if(!e.splitBetween||e.splitBetween.length===0)throw new Error("At least one person must be selected for splitting");if(e.splitBetween.filter(o=>!t.members.find(s=>s.id===o)).length>0)throw new Error("Invalid members selected for splitting");return!0}}const N={USD:"$",EUR:"€",GBP:"£",JPY:"¥",AUD:"A$",CAD:"C$",CHF:"CHF",CNY:"¥",INR:"₹"},Y=Object.keys(N);function x(n,e){const t=N[e]||e,o=Math.abs(n).toFixed(2);return n<0?`-${t}${o}`:`${t}${o}`}function p(n,e="info"){const t=document.getElementById("toastContainer"),r=document.createElement("div");r.className=`toast ${e}`,r.textContent=n,t.appendChild(r),setTimeout(()=>{r.remove()},g.TOAST_DURATION)}function X(){if(!document.getElementById("toastContainer")){const n=document.createElement("div");n.id="toastContainer",n.className="toast-container",document.body.appendChild(n)}}function P(n){const e=document.getElementById(n);e&&e.classList.add("active")}function I(n){const e=document.getElementById(n);e&&e.classList.remove("active")}function W(){document.querySelectorAll(".modal").forEach(n=>{n.addEventListener("click",e=>{e.target===n&&n.classList.remove("active")})}),document.querySelectorAll(".modal-close").forEach(n=>{n.addEventListener("click",()=>{const e=n.closest(".modal");e&&e.classList.remove("active")})})}function O(n){const e=document.getElementById("syncIndicator"),t=document.getElementById("syncStatus"),r=e.querySelector(".spinner");switch(e.className="bottom-sync-indicator",r.classList.add("hidden"),n){case"syncing":e.classList.add("syncing"),r.classList.remove("hidden"),t.textContent="Syncing...";break;case"success":t.textContent="Synced";break;case"error":e.classList.add("error"),t.textContent="Sync error";break;default:t.textContent="Ready"}}function Q(n,e){const t=document.getElementById("expensePaidBy"),r=document.getElementById("splitBetweenContainer"),o=document.getElementById("expenseCurrency");o.innerHTML=Y.map(a=>`<option value="${a}">${N[a]} ${a}</option>`).join("");const s=n.expenses.length>0?n.expenses[0].currency:"USD";o.value=s,t.innerHTML=n.members.map(a=>`<option value="${a.id}">${a.name}</option>`).join(""),t.value=e,r.innerHTML=n.members.map(a=>`
        <label class="checkbox-item">
            <input type="checkbox" name="splitBetween" value="${a.id}" checked>
            <span>${a.name}</span>
        </label>
    `).join("")}function z(n,e){const t=document.getElementById("settlementFrom"),r=document.getElementById("settlementTo"),o=document.getElementById("settlementCurrency");o.innerHTML=Y.map(m=>`<option value="${m}">${N[m]} ${m}</option>`).join("");const s=n.expenses.length>0?n.expenses[0].currency:"USD";o.value=s;const a=n.members.map(m=>`<option value="${m.id}">${m.name}</option>`).join("");t.innerHTML=a,r.innerHTML=a,t.value=e;const i=n.members.find(m=>m.id!==e);i&&(r.value=i.id)}class Z{constructor(){this.cache=new Map}get(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<g.CACHE_DURATION?t.data:null}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}cleanup(){const e=Date.now();for(const[t,r]of this.cache.entries())e-r.timestamp>=g.CACHE_DURATION&&this.cache.delete(t)}}async function k(n,e,t,r=g.REQUEST_TIMEOUT){const o=e.get(t);if(o)return o;const s=new Promise((a,i)=>setTimeout(()=>i(new Error("Timeout")),r));try{const a=await Promise.race([n.getProject(t),s]);return e.set(t,a),a}catch(a){const i=e.cache.get(t);if(i)return i.data;throw a}}class ee{constructor(){this.cache=new Map}get(e){if(!this.cache.has(e)){const t=document.getElementById(e);return t&&this.cache.set(e,t),t}return this.cache.get(e)}clear(){this.cache.clear()}}const te=new ee;function l(n){return te.get(n)}function ne(){return{landingPage:l("landingPage"),mainApp:l("mainApp"),headerNewProject:l("headerNewProject"),headerSwitchProject:l("headerSwitchProject"),projectTitle:l("projectTitle"),memberCount:l("memberCount"),membersList:l("membersList"),expensesList:l("expensesList"),expensesEmpty:l("expensesEmpty"),settlementsList:l("settlementsList"),settlementsEmpty:l("settlementsEmpty"),projectName:l("projectName"),yourName:l("yourName"),joinProjectId:l("joinProjectId"),joinYourName:l("joinYourName"),newMemberName:l("newMemberName"),expenseDescription:l("expenseDescription"),expenseAmount:l("expenseAmount"),expenseCurrency:l("expenseCurrency"),expensePaidBy:l("expensePaidBy"),splitBetweenContainer:l("splitBetweenContainer"),settlementFrom:l("settlementFrom"),settlementTo:l("settlementTo"),settlementAmount:l("settlementAmount"),settlementCurrency:l("settlementCurrency"),shareUrl:l("shareUrl"),shareStorageId:l("shareStorageId"),projectSwitcherList:l("projectSwitcherList"),newProjectExistingList:l("newProjectExistingList"),toastContainer:l("toastContainer"),syncIndicator:l("syncIndicator"),syncStatus:l("syncStatus")}}function T(n){n&&(n.style.display="block")}function j(n){n&&(n.style.display="none")}let c=null,y=null,b=null,R=!1;const E=new K,$=new V,A=new q,D=new Z;let u;async function U(){u=ne(),X(),W(),ie();const e=new URLSearchParams(window.location.search).get("project");if(e)try{try{const t=await E.getProject(e);let r=d.getUserIdForProject(e);if(!r||!t.members.find(o=>o.id===r)){const{userId:o}=d.getProjectInfo();o&&t.members.find(s=>s.id===o)&&(r=o,d.addProject(e,r))}if(r&&t.members.find(o=>o.id===r)){c=t,c.storageId=e,y=r,d.setActiveProject(e),B();return}else d.removeProject(e)}catch(t){console.error("Failed to load project from URL:",t)}document.getElementById("joinProjectId").value=e,await _(e,null)}catch(t){console.error("Failed to join project from URL:",t),F()}else{const t=d.getActiveProject();if(t){const s=d.getUserIdForProject(t);if(s)try{const a=await E.getProject(t);if(a&&a.members.find(i=>i.id===s)){c=a,c.storageId=t,y=s,B();return}}catch(a){console.error("Failed to load active project:",a),d.removeProject(t)}}const{projectId:r,userId:o}=d.getProjectInfo();if(r&&o)try{const s=d.getStorageId(r);if(s){const a=await E.getProject(s);if(a&&a.members.find(i=>i.id===o)){c=a,c.storageId=s,y=o,d.addProject(s,o),d.setActiveProject(s),B();return}}}catch(s){console.error("Failed to load project from storage:",s)}F()}}function B(){j(u.landingPage),T(u.mainApp),T(u.headerNewProject),T(u.headerSwitchProject),C(),re()}function F(){u.landingPage.style.display="flex",j(u.mainApp),j(u.headerNewProject),j(u.headerSwitchProject),oe()}async function J(n,e){try{const t=$.createProject(n,e),{storageId:r}=await E.createProject(t);return t.storageId=r,c=t,y=t.userId,d.addProject(r,t.userId),d.setActiveProject(r),B(),p("Project created successfully!","success"),t}catch(t){throw p("Failed to create project. Please try again.","error"),t}}async function _(n,e){try{let t=n,r;const o=d.getStorageId(n);if(o&&(t=o),r=await E.getProject(t),$.validateProject(r),r.storageId=t,e)y=$.addMember(r,e).id,await M(r);else{let s=d.getUserIdForProject(t);if(s||(s=d.getProjectInfo().userId),s&&r.members.find(a=>a.id===s))y=s;else{showJoinModal();return}}c=r,c.storageId=t,d.addProject(t,y),d.setActiveProject(t),B(),p("Joined project successfully!","success"),setTimeout(()=>H(),100)}catch(t){throw p("Failed to join project. Invalid project ID.","error"),t}}async function M(n=c){if(!n||!n.storageId)return console.error("Cannot save: missing project data or storage ID"),!1;try{return n.version++,n.lastUpdated=Date.now(),await E.updateProject(n.storageId,n),D.delete(n.storageId),!0}catch(e){return p("Failed to save changes","error"),console.error("Save error:",e),!1}}async function H(){if(!(!c||!c.storageId||R)){R=!0,O("syncing");try{const n=await E.getProject(c.storageId),e=$.mergeProjects(c,n);if(e!==c){const t=c.storageId;c=e,c.storageId=t,C()}O("success")}catch(n){O("error"),console.error("Sync error:",n)}finally{R=!1}}}function re(){b&&clearInterval(b),b=setInterval(H,g.SYNC_INTERVAL)}function oe(){b&&(clearInterval(b),b=null)}function C(){c&&(u.projectTitle.textContent=c.name,se(),ae(),ce())}function se(){const n=A.calculateBalances(c);u.memberCount.textContent=c.members.length,u.membersList.innerHTML="",c.members.forEach(e=>{const t=n[e.id]||{},r=document.createElement("div");r.className="member-item";const o=[];let s=!1;Object.entries(t).forEach(([f,h])=>{Math.abs(h)>.01&&(s=!0,h>.01?o.push(`+${x(h,f)}`):o.push(`-${x(Math.abs(h),f)}`))});const a=s?o.join(", "):"Settled up",i=o.some(f=>f.startsWith("+"))?"positive":o.some(f=>f.startsWith("-"))?"negative":"",m=e.id===y,w=!m&&c.members.length>1;r.innerHTML=`
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span class="member-name">${e.name}${m?" (You)":""}</span>
                ${w?`<button class="btn btn-danger btn-sm" style="padding: 0.125rem 0.375rem; font-size: 0.75rem;" onclick="removeMember('${e.id}', '${e.name.replace(/'/g,"\\'")}')">×</button>`:""}
            </div>
            <span class="member-balance ${i}">${a}</span>
        `,u.membersList.appendChild(r)})}function ae(){if(c.expenses.length===0){j(u.expensesList),T(u.expensesEmpty);return}u.expensesList.style.display="flex",j(u.expensesEmpty),u.expensesList.innerHTML="",c.expenses.forEach(n=>{var s;const e=document.createElement("div");e.className="expense-item";const t=c.members.find(a=>a.id===n.paidBy),r=n.splitBetween.map(a=>c.members.find(i=>i.id===a)).filter(Boolean).map(a=>a.name),o=G(n.timestamp);e.innerHTML=`
            <div class="expense-header">
                <div>
                    <div class="expense-description">${n.description}</div>
                    <div class="expense-details">
                        ${(t==null?void 0:t.name)||"Unknown"} paid ${x(n.amount,n.currency)}
                    </div>
                    <div class="expense-details">
                        Split between: ${r.join(", ")}
                    </div>
                </div>
                <div class="expense-amount">${x(n.amount,n.currency)}</div>
            </div>
            <div class="expense-meta">
                <span>${o}</span>
                <span>Added by ${((s=c.members.find(a=>a.id===n.addedBy))==null?void 0:s.name)||"Unknown"}</span>
            </div>
        `,u.expensesList.appendChild(e)})}function ce(){const n=A.calculateSettlements(c);if(!Object.values(n).some(t=>t.length>0)){j(u.settlementsList),T(u.settlementsEmpty);return}u.settlementsList.style.display="flex",j(u.settlementsEmpty),u.settlementsList.innerHTML="",Object.entries(n).forEach(([t,r])=>{if(r.length>0){const o=document.createElement("div");o.className="settlements-currency-header",o.style.cssText="font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; color: var(--gray-700);",o.textContent=`${N[t]} ${t}`,u.settlementsList.appendChild(o),r.forEach(s=>{const a=document.createElement("div");a.className="settlement-item";const i=c.members.find(w=>w.id===s.from),m=c.members.find(w=>w.id===s.to);a.innerHTML=`
                    <span class="settlement-text">
                        ${(i==null?void 0:i.name)||"Unknown"} → ${(m==null?void 0:m.name)||"Unknown"}
                    </span>
                    <span class="settlement-amount">
                        ${x(s.amount,t)}
                    </span>
                    <button class="btn btn-success btn-sm" onclick="recordSettlement('${s.from}', '${s.to}', ${s.amount}, '${t}')">
                        Settle Up
                    </button>
                `,u.settlementsList.appendChild(a)})}})}function ie(){document.getElementById("createProjectForm").addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("projectName").value,t=document.getElementById("yourName").value;await J(e,t),n.target.reset()}),document.getElementById("joinProjectForm").addEventListener("submit",async n=>{n.preventDefault();let e=document.getElementById("joinProjectId").value.trim();const t=document.getElementById("joinYourName").value;if(e.includes("?project="))e=new URLSearchParams(e.split("?")[1]).get("project");else if(e.includes("http")){p("Invalid share link. Please use the link from the share dialog.","error");return}await _(e,t),I("joinModal"),n.target.reset()}),document.getElementById("addMemberForm").addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("newMemberName").value;$.addMember(c,e),await M(),C(),p("Member added successfully!","success"),n.target.reset()}),document.getElementById("addExpenseForm").addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("expenseDescription").value,t=document.getElementById("expenseAmount").value,r=document.getElementById("expenseCurrency").value,o=document.getElementById("expensePaidBy").value,s=Array.from(document.querySelectorAll('input[name="splitBetween"]:checked')).map(a=>a.value);try{const a=A.createExpense(e,t,r,o,s,y);A.validateExpense(a,c),c.expenses.unshift(a),await M(),I("addExpenseModal"),C(),p("Expense added successfully!","success"),n.target.reset()}catch(a){p(a.message,"error")}}),document.getElementById("settlementForm").addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("settlementFrom").value,t=document.getElementById("settlementTo").value,r=document.getElementById("settlementAmount").value,o=document.getElementById("settlementCurrency").value,s=A.createSettlement(e,t,r,o,y);c.expenses.unshift(s),await M(),I("settlementModal"),C(),p("Payment recorded!","success"),n.target.reset()}),document.getElementById("newProjectForm").addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("newProjectName").value,t=document.getElementById("newProjectYourName").value;await J(e,t),I("newProjectModal"),n.target.reset()}),document.getElementById("switcherJoinForm").addEventListener("submit",async n=>{n.preventDefault();let e=document.getElementById("switcherJoinId").value.trim();const t=document.getElementById("switcherJoinName").value;if(e.includes("?project="))e=new URLSearchParams(e.split("?")[1]).get("project");else if(e.includes("http")){p("Invalid share link. Please use the link from the share dialog.","error");return}await _(e,t),I("projectSwitcherModal"),n.target.reset()})}window.showJoinModal=()=>P("joinModal");window.showShareModal=()=>{const n=`${window.location.origin}${window.location.pathname}?project=${c.storageId}`;document.getElementById("shareUrl").value=n,document.getElementById("shareStorageId").value=c.storageId,P("shareModal")};window.showAddExpenseModal=()=>{Q(c,y),P("addExpenseModal")};window.showSettlementModal=()=>{z(c,y),P("settlementModal")};window.copyShareUrl=()=>{document.getElementById("shareUrl").select(),document.execCommand("copy"),p("Link copied to clipboard!","success")};window.copyStorageId=()=>{document.getElementById("shareStorageId").select(),document.execCommand("copy"),p("Storage ID copied to clipboard!","success")};window.recordSettlement=(n,e,t,r)=>{document.getElementById("settlementFrom").value=n,document.getElementById("settlementTo").value=e,document.getElementById("settlementAmount").value=t.toFixed(2),document.getElementById("settlementCurrency").value=r||"USD",P("settlementModal")};window.createNewProject=async()=>{const n=document.getElementById("newProjectExistingList"),e=d.getProjects();if(e.length>0){n.innerHTML='<div class="loading"><span class="spinner"></span> Loading your projects...</div>';const t=e.map(async s=>{try{const a=await k(E,D,s.storageId),i=a.members.find(m=>m.id===s.userId);if(a&&i){const m=s.storageId===(c==null?void 0:c.storageId);return{storageId:s.storageId,name:a.name,memberName:i.name,isCurrentProject:m}}return null}catch{return d.removeProject(s.storageId),null}}),o=(await Promise.all(t)).filter(s=>s!==null).map(s=>`
                <div class="project-switcher-item ${s.isCurrentProject?"current-project":""}">
                    <div>
                        <div class="project-name">${s.name}${s.isCurrentProject?" (current)":""}</div>
                        <div class="project-meta">You are: ${s.memberName}</div>
                    </div>
                    ${s.isCurrentProject?"":`<button class="btn btn-primary btn-sm" onclick="switchToProjectFromModal('${s.storageId}')">Switch</button>`}
                </div>
            `);n.innerHTML=o.length>0?o.join(""):'<p class="text-muted text-center">No existing projects</p>'}else n.innerHTML='<p class="text-muted text-center">No existing projects</p>';P("newProjectModal")};window.removeMember=async(n,e)=>{const t=c.expenses.some(o=>o.paidBy===n||o.splitBetween.includes(n));let r=`Remove ${e} from the project?`;if(t&&(r+=`

Warning: This member is part of existing expenses. Removing them will affect balance calculations.`),confirm(r))try{c.members=c.members.filter(o=>o.id!==n),c.expenses.forEach(o=>{o.splitBetween=o.splitBetween.filter(s=>s!==n),o.splitBetween.length===0&&(o.splitBetween=[o.paidBy])}),await M(),C(),p(`${e} has been removed from the project`,"success")}catch(o){p("Failed to remove member","error"),console.error("Remove member error:",o)}};window.showProjectSwitcher=async()=>{const n=d.getProjects(),e=document.getElementById("projectSwitcherList");if(n.length<=1){p("No other projects to switch to","info");return}e.innerHTML='<div class="loading"><span class="spinner"></span> Loading projects...</div>',P("projectSwitcherModal");const r=n.filter(a=>a.storageId!==(c==null?void 0:c.storageId)).map(async a=>{try{const i=await k(E,D,a.storageId),m=i.members.find(w=>w.id===a.userId);return i&&m?{storageId:a.storageId,name:i.name,memberName:m.name,success:!0}:null}catch{return d.removeProject(a.storageId),null}}),s=(await Promise.all(r)).filter(a=>a!==null).map(a=>`
            <div class="project-switcher-item">
                <div>
                    <div class="project-name">${a.name}</div>
                    <div class="project-meta">You are: ${a.memberName}</div>
                </div>
                <div class="project-actions">
                    <button class="btn btn-primary btn-sm" onclick="loadProject('${a.storageId}')">Switch</button>
                    <button class="btn btn-danger btn-sm" onclick="removeProjectFromList('${a.storageId}')">Remove</button>
                </div>
            </div>
        `);e.innerHTML=s.length>0?s.join(""):'<p class="text-muted text-center">No other projects available</p>'};window.loadProject=async n=>{try{const e=d.getUserIdForProject(n);if(!e){p("User information not found for this project","error");return}const t=await E.getProject(n);if(!t.members.find(r=>r.id===e)){p("You are no longer a member of this project","error"),d.removeProject(n);return}c=t,c.storageId=n,y=e,d.setActiveProject(n),I("projectSwitcherModal"),B()}catch(e){p("Failed to load project","error"),console.error("Load project error:",e)}};window.removeProjectFromList=n=>{d.removeProject(n),showProjectSwitcher(),p("Project removed from your list","success")};window.switchToProjectFromModal=async n=>{I("newProjectModal"),await loadProject(n)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U):U();
