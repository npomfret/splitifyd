# webapp-v2/src Code Review

## Findings

1. **High – Currency amount input only fires on blur** (`components/ui/CurrencyAmountInput.tsx:165-206`): The amount field and the currency search both rely on native `onChange` handlers. In core Preact this maps to the DOM `change` event, so typing does not update state until the input blurs. Users see stale values, validation never runs while typing, and `useCurrencySelector` never receives search terms in real time. Switch these handlers to `onInput` (or wrap via the shared `Input` component) so the store reacts on every keystroke.  
2. **High – Category suggestion input uses `onChange`** (`components/ui/CategorySuggestionInput.tsx:143-159`): The category picker makes the same mistake, so filtering only occurs after blur. This breaks keyboard discovery of options and contradicts the UX expectations set by other fields that use `onInput`. Updating to `onInput` (and keeping the existing debounced filtering) restores live feedback.  
3. **Medium – `navigateTo` never resolves promptly for querystring routes** (`services/navigation.service.ts:64-91`): The promise resolves when `window.location.pathname === path`, but callers pass values that already contain `?`. After navigation the pathname is `/login` while `path` is `/login?returnUrl=…`, so the loop burns through 50 attempts (~500 ms) before resolving. Any code awaiting `goToLogin` or `loginWithReturnUrl` hits that artificial delay. Compare against the full URL (`fullPath`) or strip the query before comparing.  
4. **Medium – Three.js globe leaks listeners and WebGL resources** (`components/landing/Globe.tsx:20-205`): `initGlobe` returns a cleanup function, but the effect ignores it and only flips `mounted = false`. Resize/visibility listeners remain registered, animation frames keep running, and the renderer DOM node stays attached after navigation. Capture the cleanup returned by `initGlobe()` and call it in the effect’s return handler so we dispose the renderer, observers, and event listeners.  
5. **High – Config store can’t recover after a failed fetch** (`stores/config-store.ts:52-71`): `loadConfig` sets `#initialized = true` before awaiting `firebaseConfigManager.getConfig()`. If that call throws, we rethrow but never reset `#initialized`, so future calls bail out early and the app stays without config (warning banner, feature flags, etc.). Reset the flag inside the catch/finally path (or only flip it after a successful fetch) so retries work.

