<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/src/assets/logo.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>App</title>
        <!-- Theme CSS MUST load before Tailwind to set CSS variables -->
        <link id="tenant-theme-stylesheet" rel="stylesheet" href="/api/theme.css" />
        <script id="tenant-theme-bootstrap">
            (function () {
                var hostKey = window.location.host || 'default';
                var storageKey = 'tenant-theme:' + hostKey + ':hash';
                var storedHash = '';
                try {
                    storedHash = window.localStorage.getItem(storageKey) || '';
                } catch (err) {
                    storedHash = '';
                }

                window.__tenantTheme = {
                    storageKey: storageKey,
                    hash: storedHash,
                    retryCount: 0,
                };

                var link = document.getElementById('tenant-theme-stylesheet');

                // Retry logic for theme.css load failures.
                // Firebase emulator's hosting-to-functions proxy can fail intermittently,
                // returning empty responses. This doesn't occur in production.
                function retryThemeLoad() {
                    var maxRetries = 3;
                    var retryDelay = 500;
                    if (window.__tenantTheme.retryCount < maxRetries) {
                        window.__tenantTheme.retryCount++;
                        setTimeout(function () {
                            var baseHref = '/api/theme.css';
                            var params = [];
                            if (storedHash) {
                                params.push('v=' + encodeURIComponent(storedHash));
                            }
                            params.push('_retry=' + window.__tenantTheme.retryCount);
                            link.href = baseHref + '?' + params.join('&');
                        }, retryDelay);
                    }
                }

                if (link) {
                    link.onerror = retryThemeLoad;

                    // Update href with cache-busting hash if available
                    if (storedHash) {
                        link.href = '/api/theme.css?v=' + encodeURIComponent(storedHash);
                    }
                }
            })();
        </script>
    </head>
    <body>
        <div id="app"></div>
        <script prerender type="module" src="/src/main.tsx"></script>
    </body>
</html>
